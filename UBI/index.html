<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
    <title>Places near you</title>
</head>

<style>
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: Arial, Helvetica, sans-serif;
        background-color: rgb(184, 219, 230);
    }

    #map {
        height: 80vh;
        width: 80vw;
    }

    h2 {
        margin: 10px;
        color: #333;
        text-align: center;
    }

    div {
        margin: 10px;
        color: #555;
        text-align: center;
    }

    input {
        margin: 10px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    button {
        margin: 10px;
        padding: 10px;
        background-color: rgb(144, 203, 240);
        border: none;
        border-radius: 15%;
        color: #fff;
        font-weight: bold;
        cursor: pointer;
    }

    button:hover {
        background-color: rgb(18, 183, 238);
    }
</style>

<body>
    <h2>Location Recommender</h2>
    <div>Enter what you would like to search for: </div>
    <input id = "place">
    <div>Enter your search radius in m: </div>
    <input id = "radius" type="number">
    <button onclick="findPlaces()">Submit</button>
    <div id="map" style="height:80vh;width:80vw"></div>
</body>
<script>

        let lat;
        let long;
        navigator.geolocation.getCurrentPosition((position) => {
        lat = position.coords.latitude
        long = position.coords.longitude
        alert(`Your location is\n Latitude: ${lat}, Longitude: ${long}`)
    })
    console.log(lat,long)

    const findPlaces = async () => {
        const place = document.getElementById('place').value;
        const radius = document.getElementById('radius').value;
        var map = L.map('map').setView([lat,long], 13);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        L.marker([lat,long]).addTo(map)
            .bindPopup('Your current location')
            .openPopup();
        

            const url = `https://trueway-places.p.rapidapi.com/FindPlacesNearby?location=${lat}%2C${long}&type=${place}&radius=${radius}&language=en`;
            const options = {
                method: 'GET',
                headers: {
                    'X-RapidAPI-Key': '630ceab4a3mshcfba19e4f804eefp1ef079jsn1726396e50ca',
                    'X-RapidAPI-Host': 'trueway-places.p.rapidapi.com'
                }
            };

        try {
            const response = await fetch(url, options);
            let result = await response.text();
            result = JSON.parse(result)
            for (let i in result.results){
                console.log(result.results[i])
                L.marker([result.results[i].location.lat,result.results[i].location.lng]).addTo(map)
                .bindPopup(result.results[i].name)
                .openPopup();
            }
        } catch (error) {
            console.error(error);
        }
    }



</script>
</html>